<% content_for :turbo_frame_content do %>
  <%= turbo_frame_tag :drawer, data: { controller: 'drawer', action: 'turbo:before-frame-render->drawer#animate' } %>
<% end %>

<section>
  <div class="mx-auto min-w-screen-xl max-w-screen-xl 2xl:px-0">
    <div class="flex flex-col gap-4 lg:flex-row lg:items-start">
      <div class="min-w-0 flex-1 space-y-4">
        <div class="flex items-start justify-between rounded-lg border border-primary-200 bg-white p-6 shadow-sm">
          <%= form_with(model: Order.new, html: { id: 'new-order-form' }, data: { turbo: false }) do |f| %>
            <div id="orders-address">
              <%= render partial: 'orders/address', locals: { address: @address } %>
            </div>
          <% end %>

          <div class="sm:text-xs">
            <% if @address.present? %>
              <%= link_to t('.change_address'), order_addresses_path, class: 'text-xs sm:text-base font-medium text-blue-600 hover:underline active:underline', data: { turbo_frame: :remote_modal } %>
            <% else %>
              <%= link_to t('.add_address'), new_address_path, class: 'text-xs sm:text-base font-medium text-blue-600 hover:underline', data: { turbo_frame: :drawer } %>
            <% end %>
          </div>
        </div>

        <div class="flex flex-col rounded-lg border border-primary-200 bg-white p-6 shadow-sm gap-4 max-h-200 overflow-y-auto">
          <h3 class="text-xl font-semibold text-black"><%= t('.products') %></h3>
          <%= render partial: 'carts/item', collection: @cart.items %>
        </div>
      </div>

      <div class="rounded-lg border border-primary-200 bg-white p-6 shadow-sm w-full space-y-6 lg:mt-0 lg:max-w-xs xl:max-w-md">
        <!-- Order Summary Title -->
        <div class="border-b border-primary-200 pb-3">
          <h3 class="text-lg font-semibold text-black"><%= t('.order_summary') %></h3>
        </div>

        <!-- Order Breakdown -->
        <div class="space-y-4">
          <!-- Products Subtotal -->
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <svg class="h-4 w-4 text-primary-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
              </svg>
              <div class="text-sm font-normal text-primary-600"><%= t('.products_subtotal') %></div>
            </div>
            <div id="<%= dom_id(current_cart, :products_price_order) %>" class="text-sm font-semibold text-black">
              <%= render 'products_price' %>
            </div>
          </div>

          <!-- Shipping Label -->
          <div class="flex items-start justify-between gap-4">
            <div class="flex items-center gap-2 flex-shrink-0">
              <svg class="h-4 w-4 text-primary-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
              </svg>
              <div class="text-sm font-normal text-primary-600"><%= t('.shipping_label') %></div>
            </div>
            <div id="<%= dom_id(current_cart, :label_price_order) %>" class="text-sm font-semibold text-black flex-1 min-w-0">
              <%= render 'label_price' %>
            </div>
          </div>

          <!-- Divider -->
          <div class="border-t-2 border-primary-300 pt-4"></div>

          <!-- Total -->
          <div class="flex items-center justify-between">
            <div class="text-base font-bold text-black"><%= t('.total') %></div>
            <div id="<%= dom_id(current_cart, :total_order) %>" class="text-lg font-bold text-magenta-500">
              <%= render 'total' %>
            </div>
          </div>
        </div>

        <!-- Action Button -->
        <div class="pt-2">
          <%= button_tag t('.make_order_and_pay'), type: :submit, form: 'new-order-form', class: "form--submit #{class_names('disabled:pointer-events-none': @address.nil?, 'disabled:opacity-50': @address.nil?)}", disabled: @address.nil?, 'aria-disabled': @address.nil? %>
        </div>
      </div>
    </div>
  </div>
</section>
